## 4.外部から変数を変える

### 4-1.変更の種類と例題

- 外部から変数値を与える方法は 3 種類ある。
- 変数の上書き順としては、下記表で上から順に行われる。

| 種類         | 説明                                                                                    |
| ------------ | --------------------------------------------------------------------------------------- |
| 環境変数     | 環境変数へあらかじめ設定してある値を利用する。 / `TF_VAR_<NAME>`                        |
| 変数ファイル | あらかじめ決められた変数ファイル名のファイルに指定する。 / `terraform.tfstate`          |
| コマンド引数 | 次のコマンド引数で指定された値を利用する。 / `-var NAME=VALUE` , `var-file <FILE_PATH>` |

(例 1)

- `main.tf`内に message という文字列が定義されている
- "HELLO World!"という文字列に上書きしてあげ、ビルド実行するというもの

```hcl:main.tf
variable "message" {
  type    = string
  default = "nothing"
}
```

```bash
export TF_VAR_message="HELLO World!"
terraform apply
```

(例 2)

- 変数ファイルを使用して上書きする
- terraform.tfvars という変数ファイルに、上書きしたい定義を記載する

```hcl:main.tf
variable "message" {
  type    = string
  default = "nothing"
}
```

```hcl:terraform.tfvars
message = "HELLO World!"
```

```bash
terraform apply
```

(例 3)

- コマンドを使用して上書きを実施する

```hcl:main.tf
variable "message" {
  type    = string
  default = "nothing"
}
```

```bash
terraform apply -var message="HELLO World!"
```

### 4-2.変数の上書き使い分け

| 種類         | 使い分け                                                                                                                                                                    |
| ------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 環境変数     | 実行ログに残らない(tfstate には場合により出力される)鍵情報(ファイルとして残したくないもの)、環境依存情報(dev, stg など)                                                     |
| 変数ファイル | Git 管理できる = 構成管理として残せるロジック(プロビジョン手続き)とデータ(変数)は切り離すことで Git 管理したときに変更箇所が明確になる。 / データは変数ファイルに記載する。 |
| コマンド引数 | 実行ログに残る。テストで部分的に変更したい。デバッグで一部変更したいなど、一時的な利用。                                                                                    |
